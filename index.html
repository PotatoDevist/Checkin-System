<!DOCTYPE html>
<html>
<head>
<title>LKA Check-In</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      background-color: #0E100F; 
      color: #f5f5f5; 
  }
  label { display: block; margin-top: 10px; }
  select, input[type="radio"] { margin-top: 5px; }
  button { 
      margin-top: 15px; 
      padding: 10px; 
      background-color: #222831; 
      color: #ffffff; 
      border: none; 
      cursor: pointer; 
  }
  button:disabled {
      background-color: #555555;
      cursor: not-allowed;
  }
  p { margin-top: 15px; }

  /* Responsive image class */
  .responsive-img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: auto;
  }
</style>
</head>
<body>

<h2>LKA Check-In</h2>

<!-- Important Notes converted to text -->
<div style="background-color: #0E0F10; padding: 15px; border-radius: 8px; color: #FFFFFF;">
  <h3>ðŸ“Œ Catatan Penting bagi Siswa atas Fasilitas Yayasan</h3>
  <ol>
    <li>Semua siswa diminta datang pada <strong style="color:red;">jam 08.45 WIB</strong>. Di atas jam tersebut maka dianggap tidak hadir.</li>
    <li>Semua siswa berhak menyampaikan ketidakhadirannya pada pengurus pendataan (<strong>0852 1136 6909 â€“ Kak Abdil</strong>).</li>
    <li>Siswa yang berhak mendapatkan fasilitas harus hadir minimum <strong style="color:red;">3x dalam sebulan</strong>.</li>
  </ol>

  <h3>ðŸ“Œ Catatan Penting bagi Guru</h3>
  <ol>
    <li>Bertanggung jawab atas tugasnya sebagai pengurus dengan baik dan <strong style="color:red;">kompeten</strong>.</li>
    <li>Semua guru diminta datang pada <strong style="color:red;">jam 08.45 WIB</strong>.</li>
    <li>Semua guru diminta pulang sesuai jam kepulangan, yaitu setelah Dzuhur berjamaah.</li>
    <li>Semua guru diminta tidak berdiam diri (bersembunyi) dan <strong style="color:red;">inisiatif</strong> dengan tugasnya sebagai mudabbir.</li>
    <li>Laporan perkembangan atas pembelajaran siswa harus diberikan setiap 3 bulan sekali.</li>
    <li>Laporan kedisiplinan guru akan tercatat dan akan dibahas pada rapat dengan pengurus.</li>
  </ol>
</div>

<form id="checkinForm">
  <!-- Student dropdown -->
<label>Student Name:</label>
<select name="studentName" id="studentName">
  <option value="">Select student name</option>
  <option>Afifah Nabilah</option>
    <option>Ahmad Ridho</option>
    <option>Aiko Dzahin Sukotjo</option>
    <option>Ais Rosdiana</option>
    <option>Arsyila Romeesa Farzana</option>
    <option>Aprilya Srihayati</option>
    <option>Al Ghoni Achmed Jangkung</option>
    <option>Al Gipari Akbar</option>
    <option>Abit Al Akbar</option>
    <option>Alika Putri Azzahra</option>
    <option>Andika Eka Putra</option>
    <option>Angelita Berliana Yonda</option>
    <option>Aqillah Qhotrun Nada</option>
    <option>Ashfa Nadya Zulfa</option>
    <option>Asri Wulanovia</option>
    <option>Apriliya Srihayati</option>
    <option>Bunga Cantika Apriliya</option>
    <option>Dian Puspita Sari</option>
    <option>Enny Hidayah</option>
    <option>Fahmi Maulana Azis</option>
    <option>Fathur Rozid</option>
    <option>Felisa Mutiara Bahtiar</option>
    <option>Fachda Octavia</option>
    <option>Friska Anggraeni Agustin</option>
    <option>Hana Tri Wardatul Jannah</option>
    <option>Haidar Almairi</option>
    <option>Hudzaifi (Javi)</option>
    <option>Husen</option>
    <option>Ibam Purnama</option>
    <option>Ivan Ardiansyah</option>
    <option>Jihan Karimah Aulia</option>
    <option>Khairunia Rohma</option>
    <option>Lulu Ambar Sari</option>
    <option>Luna Lukiyana</option>
    <option>Marsya Ardeliansyah</option>
    <option>Mohamad Bagus Mualif</option>
    <option>Muhamad Abdul Azis</option>
    <option>Muhamad Akbar Prakoso</option>
    <option>Muhamad Fahri Sarwono</option>
    <option>Muhamad Rafli Juniansah</option>
    <option>Muhamad Raihan</option>
    <option>Muhamad Yudho Prawiro</option>
    <option>Muhammad Hafizh Arsad</option>
    <option>Muhammad Hafizh Ramadan</option>
    <option>Muhammad Khalid</option>
    <option>Muhammad Rafa Faiqul Mala</option>
    <option>Muhammad Rafli</option>
    <option>Muhammad Raihan</option>
    <option>Muhammad Rakha Prasetya</option>
    <option>Muhammad Rasya Aribawa</option>
    <option>Muhammad Riva Ramadhan</option>
    <option>Muhammad Rizqi Kurniawan</option>
    <option>Marizca Lutfillah</option>
    <option>Naila Talita Muslimah</option>
    <option>Naura Azzahra Margareti</option>
    <option>Nazwa Melinda</option>
    <option>Noval Ditiandika</option>
    <option>Precylla Areta Utomo</option>
    <option>Putri Zihan Zahira</option>
    <option>Radho Putera Ramadhan</option>
    <option>Rafika Aulia Andari</option>
    <option>Randy Daniar Rahman</option>
    <option>Regan Zufar Nadindra</option>
    <option>Rey Kausar Baihaqi</option>
    <option>Ridho Al Fakhri</option>
    <option>Risma Aprianti</option>
    <option>Rizqa Abni Kasyafani</option>
    <option>Surya Angkasa</option>
    <option>Sadam</option>
    <option>Syahzuanka Al Hadli</option>
    <option>Sahriya Zulfa Juliastika</option>
    <option>Saskia Basir</option>
    <option>Sayyid Rizik</option>
    <option>Sesya Yulinda</option>
    <option>Shefa Dwi Safira</option>
    <option>Sherina Arba Agustiana</option>
    <option>Shesa Tri Annisa</option>
    <option>Swarnna Jiwa Raksa Perbawa</option>
    <option>Syawaludin Kurniawan</option>
    <option>Tasya Oktafiani</option>
    <option>Tama Alpariz</option>
    <option>Yusuf Ansari Subagyo</option>
    <option>Yogi Arya Sulistiono</option>
</select>

<!-- Teacher dropdown -->
<label>Teacher Name:</label>
<select name="teacherName" id="teacherName">
  <option value="">Select teacher name</option>
  <option>Ustadz Nisin Mursani</option>
  <option>Ustadz Bay</option>
  <option>Ustadz Rivo</option>
</select>

<!-- Hidden role field -->
<input type="hidden" name="role" id="role">


  <label>Status:</label>
  <label><input type="radio" name="status" value="Hadir" required> Hadir</label>
  <label><input type="radio" name="status" value="Izin"> Izin</label>

  <!-- Hidden fields for coordinates and map link -->
  <input type="hidden" name="latitude" id="latitude">
  <input type="hidden" name="longitude" id="longitude">
  <input type="hidden" name="mapLink" id="mapLink">
  <input type="hidden" name="deviceId" id="deviceId">
  <input type="hidden" name="dayOfWeek" id="dayOfWeek">


  <button type="submit">Check In</button>
<p id="cooldownMsg" style="color: red; margin-top: 5px; display: none;">Please wait for one hour.</p>
</form>

<p id="message"></p>

<script>
// Generate or retrieve stored device ID
function getDeviceId() {
    let id = localStorage.getItem("deviceId");
    if (!id) {
        id = "dev-" + Math.random().toString(36).substr(2, 9);
        localStorage.setItem("deviceId", id);
    }
    return id;
}

const checkinButton = document.querySelector("button[type='submit']");
const studentSelect = document.getElementById("studentName");
const teacherSelect = document.getElementById("teacherName");
const roleField = document.getElementById("role");

let locationGranted = false;

// Cooldown check: returns true if less than 1 hour since last check-in
function isCooldownActive() {
    const lastCheckin = localStorage.getItem("lastCheckin");
    if (!lastCheckin) return false;
    return (Date.now() - parseInt(lastCheckin)) < 60 * 60 * 1000;
}

function getCooldownRemaining() {
    const lastCheckin = localStorage.getItem("lastCheckin");
    if (!lastCheckin) return 0;
    const diff = 60 * 60 * 1000 - (Date.now() - parseInt(lastCheckin));
    return Math.ceil(diff / 60000); // minutes
}

function isCooldownActive() {
    const lastCheckin = localStorage.getItem("lastCheckin");
    if (!lastCheckin) return false;
    return (Date.now() - parseInt(lastCheckin)) < 60 * 60 * 1000;
}

// Check both location, name, and cooldown before enabling button

function updateButtonState() {
    const nameSelected = studentSelect.value !== "" || teacherSelect.value !== "";
    const cooldownActive = isCooldownActive();
    checkinButton.disabled = !(locationGranted && nameSelected) || cooldownActive;

    // Show or hide cooldown message with minutes remaining
    const cooldownMsg = document.getElementById("cooldownMsg");
    if (cooldownActive) {
        const remaining = getCooldownRemaining();
        cooldownMsg.textContent = `Please wait ${remaining} minute${remaining !== 1 ? 's' : ''} before checking in again.`;
        cooldownMsg.style.display = "block";
    } else {
        cooldownMsg.style.display = "none";
    }
}


// Try to get location
navigator.geolocation.getCurrentPosition(function(pos) {
    const lat = pos.coords.latitude;
    const lng = pos.coords.longitude;

    const daysOfWeek = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    document.getElementById("dayOfWeek").value = daysOfWeek[new Date().getDay()];

    document.getElementById("latitude").value = lat;
    document.getElementById("longitude").value = lng;
    document.getElementById("mapLink").value = `https://www.google.com/maps?q=${lat},${lng}`;
    
    locationGranted = true;
    updateButtonState();

}, function(error) {
    alert("Location access is required to check in.");
    locationGranted = false;
    updateButtonState();
});

// Only one name can be selected
studentSelect.addEventListener("change", function() {
    if (this.value) {
        teacherSelect.value = "";
        teacherSelect.disabled = true;
        roleField.value = "Student";
    } else {
        teacherSelect.disabled = false;
        roleField.value = "";
    }
    updateButtonState();
});

teacherSelect.addEventListener("change", function() {
    if (this.value) {
        studentSelect.value = "";
        studentSelect.disabled = true;
        roleField.value = "Teacher";
    } else {
        studentSelect.disabled = false;
        roleField.value = "";
    }
    updateButtonState();
});

// On page load set device ID
document.getElementById("deviceId").value = getDeviceId();
updateButtonState();

// Handle form submit
document.getElementById("checkinForm").addEventListener("submit", function(e) {
    e.preventDefault();

    if (checkinButton.disabled && !isCooldownActive()) {
        alert("Please select your name and allow location access to check in.");
        return;
    }

    fetch("https://script.google.com/macros/s/AKfycbzbRFUTFFOaDmCa1RRyMU47u5cgVgB2C7BIjv1MY7d7MC9LsNBre5Pem8i_pmTof3JvUw/exec", {
        method: "POST",
        body: new FormData(this)
    })
    .then(res => res.text())
    .then(() => {
        document.getElementById("message").innerText = "Check-in recorded successfully!";
        localStorage.setItem("lastCheckin", Date.now());
        updateButtonState();
    })
    .catch(err => {
        document.getElementById("message").innerText = "Error: " + err;
    });
});
</script>




</body>
</html>













