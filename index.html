<!DOCTYPE html>
<html>
<head>
<title>LKA Check-In</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      background-color: #121212; 
      color: #f5f5f5; 
  }
  label { display: block; margin-top: 10px; }
  select, input[type="radio"] { margin-top: 5px; }
  button { 
      margin-top: 15px; 
      padding: 10px; 
      background-color: #1a73e8; 
      color: #ffffff; 
      border: none; 
      cursor: pointer; 
  }
  button:disabled {
      background-color: #555555;
      cursor: not-allowed;
  }
  p { margin-top: 15px; }
</style>
</head>
<body>

<h2>LKA Check-In</h2>
<form id="checkinForm">
  <label>Name:</label>
  <select name="name" required>
    <option value="">Select your name</option>
    <option>John Doe</option>
    <option>Jane Smith</option>
    <option>Alex Johnson</option>
    <!-- Add more names here -->
  </select>

  <label>Status:</label>
  <label><input type="radio" name="status" value="Present" required> Present</label>
  <label><input type="radio" name="status" value="Not Present"> Not Present</label>

  <input type="hidden" name="latitude" id="latitude">
  <input type="hidden" name="longitude" id="longitude">
  <input type="hidden" name="deviceId" id="deviceId">

  <button type="submit">Check In</button>
</form>

<p id="message"></p>

<script>
// Generate or retrieve stored device ID
function getDeviceId() {
    let id = localStorage.getItem("deviceId");
    if (!id) {
        id = "dev-" + Math.random().toString(36).substr(2, 9);
        localStorage.setItem("deviceId", id);
    }
    return id;
}

// Get location
navigator.geolocation.getCurrentPosition(function(pos) {
    document.getElementById("latitude").value = pos.coords.latitude;
    document.getElementById("longitude").value = pos.coords.longitude;
}, function(error) {
    alert("Location access is required to check in.");
});

// On page load set device ID and check last check-in
document.getElementById("deviceId").value = getDeviceId();

const checkinButton = document.querySelector("button[type='submit']");
const lastCheckin = localStorage.getItem("lastCheckin");

if (lastCheckin) {
    const elapsed = Date.now() - parseInt(lastCheckin);
    if (elapsed < 3600000) { // 1 hour = 3600000 ms
        checkinButton.disabled = true;
        document.getElementById("message").innerText = "You have already checked in. Please wait 1 hour.";
    }
}

// Handle form submit
document.getElementById("checkinForm").addEventListener("submit", function(e) {
    e.preventDefault();

    // Extra safety check
    if (checkinButton.disabled) return;

    const formData = new FormData(this);
    fetch("https://script.google.com/macros/s/AKfycbzd7i0BRhoA6Xr-_znY18KPXWnCtqv2FnCTaFh7eqyM0uA31u9o1CIceOtuewv97rmQWA/exec", {
        method: "POST",
        body: formData
    })
    .then(res => res.text())
    .then(data => {
        document.getElementById("message").innerText = "Check-in recorded successfully!";
        checkinButton.disabled = true;
        localStorage.setItem("lastCheckin", Date.now());
    })
    .catch(err => {
        document.getElementById("message").innerText = "Error: " + err;
    });
});
</script>

</body>
</html>
